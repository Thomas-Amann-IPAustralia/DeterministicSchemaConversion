tables:
  # 1. Primary Sheet: Core Metadata
  primary:
    filename: "Primary.csv"
    root_path: "$"
    columns:
      UDID: "identifier.value"
      Headline: "headline"
      Headline_Alt: "alternativeHeadline"
      Description: "description"
      Stable_URL: "url"
      Date_Published: "datePublished"
      Date_Modified: "dateModified"
      Geographic_Area: "audience.geographicArea.name"
      IP_Right_Name: "about.name"
      IP_Right_Wikidata_URL: "about.sameAs"
      Service_Type: "mainEntity[0]['@type']"
      Service_Name: "mainEntity[0]['name']"
      HowTo_Name: "mainEntity[?(@['@type']=='HowTo')].name"
      Service_Provider:
        path: "$"
        logic: "derive_service_provider"

  # 2. Influences Sheet: Citations
  influences:
    filename: "Influences.csv"
    root_path: "$"
    columns:
      UDID: "identifier.value"
      Headline_Alt: "alternativeHeadline"
      Influence_Priority: "const:Null (FOR NOW)"
      Influence_ID: "const:Null (FOR NOW)"
      Influence_URL: "const:Null (FOR NOW)"

  # 3. LinksTo Sheet: Outbound Links with Internal UDID Lookup
  links_to:
    filename: "LinksTo.csv"
    root_path: "relatedLink[*]"
    columns:
      UDID: "parent:identifier.value"
      Headline_Alt: "parent:alternativeHeadline"
      Destination_URL: "url"
      Destination_name: "name"
      Internal_Destination:
        path: "url"
        logic: "check_is_internal_link"
      Internal_Destination_UDID:
        path: "url"
        logic: "lookup_internal_udid"

  # 4. HowTo Sheet: Step-by-Step Instructions
  howto:
    filename: "HowTo.csv"
    root_path: "mainEntity[?(@['@type']=='HowTo')].step[*]"
    columns:
      UDID: "parent:identifier.value"
      HowTo_Name: "parent:name"
      Step_Name: "name"
      Step_Description: "text"

  # 5. FAQ Sheet: Wide Format (One row per UDID, specific columns for answers)
  faq:
    filename: "FAQ.csv"
    root_path: "$"
    columns:
      UDID: "identifier.value"
      Headline_Alt: "alternativeHeadline"
      What_are_the_benefits: "mainEntity[?(@['@type']=='FAQPage')].mainEntity[?(@['name']=='What are the benefits?')].acceptedAnswer.text"
      What_are_the_risks: "mainEntity[?(@['@type']=='FAQPage')].mainEntity[?(@['name']=='What are the risks?')].acceptedAnswer.text"
      What_might_the_cost_be: "mainEntity[?(@['@type']=='HowTo')].estimatedCost.price"
      How_much_time_might_be_involved: "mainEntity[?(@['@type']=='HowTo')].totalTime"
      Who_can_use_this: "mainEntity[?(@['@type']=='FAQPage')].mainEntity[?(@['name']=='Who can use this?')].acceptedAnswer.text"
      Whos_involved: "mainEntity[?(@['@type']=='FAQPage')].mainEntity[?(@['name']=='Who is involved?')].acceptedAnswer.text"
      How_much_is_this_used: "mainEntity[?(@['@type']=='FAQPage')].mainEntity[?(@['name']=='How much is this used?')].acceptedAnswer.text"
      What_are_the_possible_outcomes: "mainEntity[?(@['@type']=='FAQPage')].mainEntity[?(@['name']=='What are the possible outcomes?')].acceptedAnswer.text"

  # 6. Semantic Sheet: Content Chunking
  semantic:
    filename: "Semantic.csv"
    root_path: "$"
    columns:
      UDID: "identifier.value"
      Headline_Alt: "alternativeHeadline"
      Chunk_ID: "const:Null (FOR NOW)"
      Chunk_Token_Count: "const:Null (FOR NOW)"
      Chunk_Text: 
        path: "$"
        logic: "generate_semantic_chunk"
      Chunk_Embedding: "const:Null (FOR NOW)"
      Chunk_Injection: "const:Null (FOR NOW)"

  # 7. Raw Data Sheet: Full Content & Token Counts
  raw_data:
    filename: "RawData.csv"
    root_path: "$"
    columns:
      UDID: "identifier.value"
      Headline_Alt: "alternativeHeadline"
      HTML_Raw:
        path: "identifier.value"
        logic: "read_html_file"
      HTML_Raw_Token_Count:
        path: "identifier.value"
        logic: "count_html_tokens"
      MD_Raw:
        path: "identifier.value"
        logic: "read_md_file"
      MD_Raw_Token_Count:
        path: "identifier.value"
        logic: "count_md_tokens"
      JSON_Raw:
        path: "$"
        logic: "dump_json_string"
      Json_Raw_Token_Count:
        path: "$"
        logic: "count_json_tokens"
